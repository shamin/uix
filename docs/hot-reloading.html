<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="data:image/svg+xml, %3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle r='8' cx='8' cy='8' fill='%23c1f3f9'%3E%3C/circle%3E%3C/svg%3E"
    />
    <title>UIx | Hot Reloading</title>
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <link rel="stylesheet" href="main.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"
    />
  </head>
  <body>
    <header class="page-header">
      <div class="page-header-inner">
        <a class="title" href="https://pitch-io.github.io/uix/docs"
          >UIx | Idiomatic ClojureScript interface to modern React.js</a
        >
        <div class="nav">
          <a href="https://www.clojurescript.studio/p/default-uix">Sandbox</a>
          <a
            href="https://github.com/sponsors/roman01la"
            class="icon"
            title="Support"
          >
            <img src="sponsor.svg" alt="" />
          </a>
          <a
            href="https://github.com/pitch-io/uix"
            class="icon"
            title="Source code"
          >
            <img src="github.svg" alt="" />
          </a>
          <div class="version">v1.0.0</div>
        </div>
      </div>
    </header>
    <main>
            <h1 class="heading">
            Hot reloading
              <a class="anchor" href="#hot-reloading">
                <img src="/link.svg" alt="" />
              </a>
            </h1><p>While a UIx component tree can be reloaded in a traditional way, by re-rendering from the root after reload, this resets component local state and re-runs hooks. It happens because the reloaded namespace will create new component functions, which in turn invalidate the UI tree when re-rendering after reload and cause the updated components to be re-mounted.</p>
<p><a href="https://www.npmjs.com/package/react-refresh">react-refresh</a> makes it possible to reload components in a way that preserves local state and the state of hooks.</p>

            <h2 class="heading">
            Setup for shadow-cljs
              <a class="anchor" href="#setup-for-shadow-cljs">
                <img src="/link.svg" alt="" />
              </a>
            </h2><ol>
<li><p>Make sure you have <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">React DevTools</a> installed for your browser</p>
</li>
<li><p>Install the package <code>yarn add react-refresh --dev</code></p>
</li>
<li><p>Create a dev-only namespace that will be responsible for managning hot-reloading</p>
</li>
</ol>
<pre><code class="language-clojure">(ns my.app.preload
  (:require [uix.dev]))

;; initializes fast-refresh runtime
(uix.dev/init-fast-refresh!)

;; called by shadow-cljs after every reload
(defn ^:dev/after-load refresh []
  ;; performs components refresh
  (uix.dev/refresh!))
</code></pre>
<ol start="4">
<li>Add the namespace to <code>:preloads</code> so that it&#39;s only loaded in dev</li>
</ol>
<pre><code class="language-clojure">;; shadow-cljs.edn
{:builds
 {:build-id
  {:devtools {:preloads [my.app.preload]}}}}
</code></pre>
<ol start="5">
<li>That&#39;s it. Now you can edit a UIx component, hit save, and once reloaded in the browser the local state should be preserved.</li>
</ol>

            <h3 class="heading">
            Things to look out for
              <a class="anchor" href="#things-to-look-out-for">
                <img src="/link.svg" alt="" />
              </a>
            </h3><p>Make sure that your UI is not re-rendered from the root in a traditional way when using fast-refresh, otherwise fast-refresh won&#39;t work and the state will be reset.</p>
</main>
    <footer class="page-footer"><a class="nav-link" href="server-side-rendering.html">ğŸ‘ˆ Prev â€œServer Side Renderingâ€</a> <a class="nav-link" href="react-devtools.html">Next â€œReact Devtoolsâ€ ğŸ‘‰</a></footer>
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/clojure.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
